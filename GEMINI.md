# 專案分析：auto-reframe-videos

這是一個 Python 專案，旨在自動將橫向的影片 (例如 16:9) 轉換為縱向的影片 (9:16)，主要用於產出適合在手機社群媒體平台 (如 TikTok、Instagram Reels、YouTube Shorts) 上播放的短影片。

## 核心功能與特色

1.  **AI 人物偵測與智慧追蹤**：
    *   這不是簡單地從影片中央進行裁切。此專案最大的特色是利用 AI 模型 (可選用 MobileNet-SSD 或 YOLOv4-tiny) 來偵測影片每一幀畫面中的「人物」。
    *   它會以偵測到的主要人物為中心，動態計算出最佳的裁切範圍，並透過平滑演算法 (`SMOOTHING_FACTOR`) 讓鏡頭的移動看起來更自然，確保影片的主角始終保持在畫面中。

2.  **高效能硬體加速**：
    *   腳本會自動偵測使用者的電腦硬體，並優先選擇最佳的影片編碼器，順序為：**NVIDIA (NVENC) > AMD (AMF) > Intel (QSV)**。如果沒有可用的 GPU，則會使用 CPU (`libx264`)。
    *   這極大地提升了影片處理的速度，因為影片編碼是此類任務中最耗時的部分。
    *   AI 偵測部分也支援 NVIDIA 的 CUDA 加速。

3.  **自動化與易用性**：
    *   **自動模型下載**：首次執行時，腳本會自動從網路上檢查並下載所需的 AI 模型檔案。
    *   **批次處理**：使用者只需將所有待處理的影片放入 `input_videos` 資料夾，腳本會自動逐一處理。
    *   **並行處理 (Multiprocessing)**：腳本會利用多核心 CPU 並行處理多個影片檔案，以最大化處理效率。
    *   **進度條顯示**：使用 `tqdm` 為每個影片的處理過程以及整體進度提供視覺化的進度條，方便使用者了解目前進度。

## 技術棧 (Technology Stack)

根據 `requirements.txt` 和原始碼 (`autocrop_videos.py`) 分析，此專案主要依賴以下技術：

*   **Python**: 主要的程式語言。
*   **FFmpeg**: 一個必要的核心依賴，用於所有影片的讀取、編碼、裁切和音訊合併等底層操作。腳本透過 `subprocess` 模組來呼叫 FFmpeg 命令列工具。
*   **OpenCV (`opencv-python`)**: 用於讀取影片的每一幀、執行 AI 模型進行人物偵測，以及影像的前期處理。
*   **NumPy**: 用於高效的陣列與數值運算，主要配合 OpenCV 處理影像資料。
*   **Requests**: 用於從網路上自動下載 AI 模型檔案。
*   **tqdm**: 用於在命令列中顯示美觀且實用的進度條。

## 運作流程 (High-Level Workflow)

1.  **初始化**：
    *   檢查 `ffmpeg` 是否存在於系統環境變數中。
    *   檢查並下載 AI 模型檔案至 `models` 資料夾。
    *   建立 `input_videos` 和 `output_videos` 資料夾。
2.  **偵測與準備**：
    *   掃描 `input_videos` 資料夾中的所有影片檔案。
    *   呼叫 `ffmpeg -encoders` 來偵測最佳的硬體編碼器。
3.  **並行處理**：
    *   根據 CPU 核心數和影片數量，建立一個處理程序池 (Process Pool)。
    *   將每個影片分配給一個獨立的處理程序。
4.  **單一影片處理 (在子程序中)**：
    *   **第一階段 (裁切)**：
        *   使用 OpenCV 逐幀讀取影片。
        *   每隔幾幀就使用 AI 模型偵測畫面中的人物。
        *   根據人物位置計算出平滑移動後的 9:16 裁切框。
        *   將裁切後的幀透過 `pipe` (管道) 即時傳送給 FFmpeg 進行編碼，產生一個暫時的、無聲的裁切後影片。
    *   **第二階段 (合併音訊)**：
        *   檢查原始影片是否有音訊。
        *   如果有，則再次呼叫 FFmpeg，將暫時影片的視訊軌和原始影片的音訊軌合併。
    *   **第三階段 (壓縮與縮放)**：
        *   最後，再次呼叫 FFmpeg 將影片縮放至最終解析度 (1080x1920) 並設定目標位元率，產生最終的影片檔案。
5.  **完成**：
    *   所有影片處理完畢後，主程序會顯示一份成功與失敗的總結報告。

總結來說，這是一個考慮周全、效能優化且高度自動化的實用工具，完美解決了將傳統橫向影片轉換為社群媒體格式的痛點。
